import{S as X,i as Z,s as x,k as m,q as F,a as L,l as _,m as y,r as W,h,c as N,n as v,b as R,G as o,I as O,J as T,K as oe,B as A,L as ue,o as me,e as ie,M as _e,t as j,d as he,f as z,H as ve,g as be,w as fe,x as ce,y as de,z as pe}from"../../../chunks/index-b7867e78.js";import{p as ge}from"../../../chunks/stores-0d6b3360.js";import{a as C}from"../../../chunks/supabaseClient-63289d63.js";function ye(l){let t,a,e,s,c,i,u,E,r,f,d,U,n,k,b,P,G,H,D,J,S,w,B,K,V,I,Y,Q,ee;return{c(){t=m("form"),a=m("div"),e=m("label"),s=F("Email"),c=L(),i=m("input"),E=L(),r=m("div"),f=m("label"),d=F("Name"),U=L(),n=m("input"),k=L(),b=m("div"),P=m("label"),G=F("Website"),H=L(),D=m("input"),J=L(),S=m("div"),w=m("input"),K=L(),V=m("div"),I=m("button"),Y=F("Sign Out"),this.h()},l(g){t=_(g,"FORM",{});var p=y(t);a=_(p,"DIV",{});var M=y(a);e=_(M,"LABEL",{for:!0});var te=y(e);s=W(te,"Email"),te.forEach(h),c=N(M),i=_(M,"INPUT",{id:!0,type:!0}),M.forEach(h),E=N(p),r=_(p,"DIV",{});var $=y(r);f=_($,"LABEL",{for:!0});var ae=y(f);d=W(ae,"Name"),ae.forEach(h),U=N($),n=_($,"INPUT",{id:!0,type:!0}),$.forEach(h),k=N(p),b=_(p,"DIV",{});var q=y(b);P=_(q,"LABEL",{for:!0});var se=y(P);G=W(se,"Website"),se.forEach(h),H=N(q),D=_(q,"INPUT",{id:!0,type:!0}),q.forEach(h),J=N(p),S=_(p,"DIV",{});var re=y(S);w=_(re,"INPUT",{type:!0,class:!0}),re.forEach(h),K=N(p),V=_(p,"DIV",{});var ne=y(V);I=_(ne,"BUTTON",{class:!0});var le=y(I);Y=W(le,"Sign Out"),le.forEach(h),ne.forEach(h),p.forEach(h),this.h()},h(){v(e,"for","email"),v(i,"id","email"),v(i,"type","text"),i.value=u=l[0].user.email,i.disabled=!0,v(f,"for","username"),v(n,"id","username"),v(n,"type","text"),v(P,"for","website"),v(D,"id","website"),v(D,"type","website"),v(w,"type","submit"),v(w,"class","button"),w.value=B=l[1]?"Loading...":"Update",w.disabled=l[1],v(I,"class","button"),I.disabled=l[1]},m(g,p){R(g,t,p),o(t,a),o(a,e),o(e,s),o(a,c),o(a,i),o(t,E),o(t,r),o(r,f),o(f,d),o(r,U),o(r,n),O(n,l[2]),o(t,k),o(t,b),o(b,P),o(P,G),o(b,H),o(b,D),O(D,l[3]),o(t,J),o(t,S),o(S,w),o(t,K),o(t,V),o(V,I),o(I,Y),Q||(ee=[T(n,"input",l[6]),T(D,"input",l[7]),T(I,"click",l[5]),T(t,"submit",oe(l[4]))],Q=!0)},p(g,[p]){p&1&&u!==(u=g[0].user.email)&&i.value!==u&&(i.value=u),p&4&&n.value!==g[2]&&O(n,g[2]),p&8&&O(D,g[3]),p&2&&B!==(B=g[1]?"Loading...":"Update")&&(w.value=B),p&2&&(w.disabled=g[1]),p&2&&(I.disabled=g[1])},i:A,o:A,d(g){g&&h(t),Q=!1,ue(ee)}}}function Ee(l,t,a){let{session:e}=t,s=!1,c=null,i=null,u=null;me(()=>{E()});const E=async()=>{try{a(1,s=!0);const{user:n}=e,{data:k,error:b,status:P}=await C.from("profiles").select("username, website, avatar_url").eq("id",n.id).single();if(k&&(a(2,c=k.username),a(3,i=k.website),u=k.avatar_url),b&&P!==406)throw b}catch(n){n instanceof Error&&alert(n.message)}finally{a(1,s=!1)}};async function r(){try{a(1,s=!0);const{user:n}=e,k={id:n.id,username:c,website:i,avatar_url:u,updated_at:new Date};let{error:b}=await C.from("profiles").upsert(k);if(b)throw b}catch(n){n instanceof Error&&alert(n.message)}finally{a(1,s=!1)}}async function f(){try{a(1,s=!0);let{error:n}=await C.auth.signOut();if(n)throw n}catch(n){n instanceof Error&&alert(n.message)}finally{a(1,s=!1)}}function d(){c=this.value,a(2,c)}function U(){i=this.value,a(3,i)}return l.$$set=n=>{"session"in n&&a(0,e=n.session)},[e,s,c,i,r,f,d,U]}class ke extends X{constructor(t){super(),Z(this,t,Ee,ye,x,{session:0})}}function we(l){let t,a,e,s,c,i,u,E,r;return{c(){t=m("form"),a=m("div"),e=m("input"),s=L(),c=m("div"),i=m("input"),this.h()},l(f){t=_(f,"FORM",{});var d=y(t);a=_(d,"DIV",{});var U=y(a);e=_(U,"INPUT",{class:!0,type:!0,placeholder:!0}),U.forEach(h),s=N(d),c=_(d,"DIV",{});var n=y(c);i=_(n,"INPUT",{type:!0,class:!0}),n.forEach(h),d.forEach(h),this.h()},h(){v(e,"class","inputField"),v(e,"type","email"),v(e,"placeholder","Your email"),v(i,"type","submit"),v(i,"class","button block"),i.value=u=l[0]?"Loading":"Send Login link",i.disabled=l[0]},m(f,d){R(f,t,d),o(t,a),o(a,e),O(e,l[1]),o(t,s),o(t,c),o(c,i),E||(r=[T(e,"input",l[3]),T(t,"submit",oe(l[2]))],E=!0)},p(f,[d]){d&2&&e.value!==f[1]&&O(e,f[1]),d&1&&u!==(u=f[0]?"Loading":"Send Login link")&&(i.value=u),d&1&&(i.disabled=f[0])},i:A,o:A,d(f){f&&h(t),E=!1,ue(r)}}}function Ie(l,t,a){let e=!1,s="";const c=async()=>{try{a(0,e=!0);const{error:u}=await C.auth.signInWithOtp({email:s});if(u)throw u;alert("Check your email for the login link!")}catch(u){u instanceof Error&&alert(u.message)}finally{a(0,e=!1)}};function i(){s=this.value,a(1,s)}return[e,s,c,i]}class Le extends X{constructor(t){super(),Z(this,t,Ie,we,x,{})}}function Ne(l){let t,a;return t=new ke({props:{session:l[0].data.session}}),{c(){fe(t.$$.fragment)},l(e){ce(t.$$.fragment,e)},m(e,s){de(t,e,s),a=!0},p(e,s){const c={};s&1&&(c.session=e[0].data.session),t.$set(c)},i(e){a||(z(t.$$.fragment,e),a=!0)},o(e){j(t.$$.fragment,e),a=!1},d(e){pe(t,e)}}}function Ue(l){let t,a;return t=new Le({}),{c(){fe(t.$$.fragment)},l(e){ce(t.$$.fragment,e)},m(e,s){de(t,e,s),a=!0},p:A,i(e){a||(z(t.$$.fragment,e),a=!0)},o(e){j(t.$$.fragment,e),a=!1},d(e){pe(t,e)}}}function Pe(l){let t,a,e,s,c;const i=[Ue,Ne],u=[];function E(r,f){return r[0].data.session?1:0}return a=E(l),e=u[a]=i[a](l),{c(){t=L(),e.c(),s=ie(),this.h()},l(r){_e("svelte-kxjkt8",document.head).forEach(h),t=N(r),e.l(r),s=ie(),this.h()},h(){document.title="Sign in"},m(r,f){R(r,t,f),u[a].m(r,f),R(r,s,f),c=!0},p(r,[f]){let d=a;a=E(r),a===d?u[a].p(r,f):(be(),j(u[d],1,1,()=>{u[d]=null}),he(),e=u[a],e?e.p(r,f):(e=u[a]=i[a](r),e.c()),z(e,1),e.m(s.parentNode,s))},i(r){c||(z(e),c=!0)},o(r){j(e),c=!1},d(r){r&&h(t),u[a].d(r),r&&h(s)}}}function De(l,t,a){let e;return ve(l,ge,s=>a(0,e=s)),[e]}class Ve extends X{constructor(t){super(),Z(this,t,De,Pe,x,{})}}export{Ve as default};
